# HAProxy Load Balancer - Log Signatures
# Source: Elastic Filebeat HAProxy Module Documentation
# https://www.elastic.co/docs/reference/beats/filebeat/exported-fields-haproxy

signatures:
  # =============================================================================
  # HTTP Mode Logs
  # =============================================================================
  - vendor: haproxy
    product: loadbalancer
    log_type: http
    version: null
    log_format: syslog
    signature_name: HAProxy HTTP Log
    primary_pattern: haproxy.*http|haproxy\.http
    confidence: 0.95
    priority: 5
    source: elastic_filebeat
    description: HAProxy HTTP mode access and error logs
    event_type: http
    sample_logs:
      - 'haproxy[1234]: 192.168.1.1:12345 [19/Jan/2026:10:00:00.000] frontend backend/server 0/0/0/1/1 200 1234 - - ---- 1/1/1/1/0 0/0 "GET /api HTTP/1.1"'
    fields:
      - name: haproxy.frontend_name
        type: keyword
        ecs: observer.name
        cim: dest_interface
        asim: DvcInboundInterface
        description: Name of the frontend which received the connection
      - name: haproxy.backend_name
        type: keyword
        ecs: destination.domain
        cim: dest_name
        asim: DstHostname
        description: Name of the backend which managed the connection
      - name: haproxy.server_name
        type: keyword
        ecs: destination.address
        cim: dest
        asim: DstFQDN
        description: Name of the server to which connection was sent
      - name: haproxy.http.response.status_code
        type: integer
        ecs: http.response.status_code
        cim: status
        asim: HttpStatusCode
        description: HTTP response status code
      - name: haproxy.http.request.raw_request_line
        type: keyword
        ecs: http.request.line
        cim: http_request
        asim: HttpRequestLine
        description: Complete HTTP request line
      - name: haproxy.bytes_read
        type: long
        ecs: destination.bytes
        cim: bytes_out
        asim: DstBytes
        description: Total bytes transmitted to client
      - name: haproxy.time_queue
        type: long
        ecs: event.duration
        cim: duration
        asim: NetworkDuration
        description: Time spent waiting in queues (ms)
      - name: haproxy.time_backend_connect
        type: long
        ecs: event.duration
        cim: response_time
        asim: NetworkDuration
        description: Time to establish connection to server (ms)
    upstream_sources:
      - filebeat

  # =============================================================================
  # TCP Mode Logs
  # =============================================================================
  - vendor: haproxy
    product: loadbalancer
    log_type: tcp
    version: null
    log_format: syslog
    signature_name: HAProxy TCP Log
    primary_pattern: haproxy.*tcp|haproxy\.tcp
    confidence: 0.9
    priority: 10
    source: elastic_filebeat
    description: HAProxy TCP mode connection logs
    event_type: connection
    sample_logs:
      - 'haproxy[1234]: 192.168.1.1:12345 [19/Jan/2026:10:00:00.000] frontend backend/server 1/2/3 1234 -- 1/1/1/1/0 0/0'
    fields:
      - name: haproxy.tcp.connection_waiting_time_ms
        type: long
        ecs: event.duration
        cim: duration
        asim: NetworkDuration
        description: Time between accept and last close (ms)
      - name: haproxy.termination_state
        type: keyword
        ecs: event.outcome
        cim: result
        asim: EventResult
        description: Session termination condition
      - name: haproxy.mode
        type: keyword
        ecs: network.protocol
        cim: protocol
        asim: NetworkProtocol
        description: Frontend operating mode (TCP or HTTP)
    upstream_sources:
      - filebeat

  # =============================================================================
  # Error Logs
  # =============================================================================
  - vendor: haproxy
    product: loadbalancer
    log_type: error
    version: null
    log_format: syslog
    signature_name: HAProxy Error Log
    primary_pattern: haproxy.*error|error_message
    confidence: 0.9
    priority: 5
    source: elastic_filebeat
    description: HAProxy error events
    event_type: error
    sample_logs:
      - 'haproxy[1234]: Server backend/server is DOWN, reason: Layer4 connection problem'
    fields:
      - name: haproxy.error_message
        type: text
        ecs: error.message
        cim: error_message
        asim: EventMessage
        description: Error message logged by HAProxy
    upstream_sources:
      - filebeat

metadata:
  vendor: HAProxy
  product: LoadBalancer
  product_full_name: HAProxy Load Balancer
  documentation_url: https://www.elastic.co/docs/reference/beats/filebeat/exported-fields-haproxy
  created_date: "2026-01-19"
  created_by: Claude (SIEMLess AI) - Based on Elastic Filebeat Documentation
  log_formats:
    - syslog
    - json
  categories:
    - http
    - tcp
    - error
    - connection
