title: Abuse.ch Malware Submissions (MD5)
id: 3d69b407-655f-4f92-a15e-d7e47de21b3e
status: experimental
level: medium
description: |
  KQL detection rule: Abuse.ch Malware Submissions (MD5)
author: Bert-JanP
logsource:
  product: microsoft_threat_hunting
  service: kql
detection:
  _kql_query: |
    let MalwareSampleMD5 = externaldata(MD5: string)[@"https://bazaar.abuse.ch/export/txt/md5/recent"] with (format="txt", ignoreFirstRecord=True);
    let MD5Regex = '[a-f0-9]{32}';
    let MaliciousMD5 = materialize (
          MalwareSampleMD5
          | where MD5 matches regex MD5Regex
          | distinct MD5
          );
    DeviceFileEvents
    | where MD5 has_any (MaliciousMD5)
  condition: _kql_query
references:
  - https://github.com/Bert-JanP/Hunting-Queries-Detection-Rules
