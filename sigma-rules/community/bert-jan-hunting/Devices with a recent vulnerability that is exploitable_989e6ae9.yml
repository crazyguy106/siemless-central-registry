title: Devices with a recent vulnerability that is exploitable
id: 86392c79-e5fb-48a8-97a3-414fccd0613f
status: experimental
level: medium
description: |
  KQL detection rule: Devices with a recent vulnerability that is exploitable
author: Bert-JanP
logsource:
  product: microsoft_security
  service: kql
detection:
  _kql_query: |
    let timeframe = 30d; //Customizable h = hours, d = days
let ExploitableVulnerabilities = materialize 
(DeviceTvmSoftwareVulnerabilitiesKB
     | where IsExploitAvailable == 1
     | where PublishedDate > (now() - timeframe)
     | project CveId);
DeviceTvmSoftwareVulnerabilities
| join ExploitableVulnerabilities on CveId
| summarize count(), ExploitableCVE = make_set(CveId) by DeviceName
| top 10 by count_
  condition: _kql_query
references:
  - https://github.com/Bert-JanP/Hunting-Queries-Detection-Rules
