title: Top 10 devices with the most exploitable vulnerabilities
id: 360ce4db-23f4-4389-9a74-b5ec5156dc50
status: experimental
level: medium
description: |
  This query lists the 10 devices in your tenant with the most exploitable vulnerabilities.

  ## Defender XDR
author: Bert-JanP
logsource:
  product: microsoft_security
  service: kql
detection:
  _kql_query: |
    let ExploitableVulnerabilities = DeviceTvmSoftwareVulnerabilitiesKB
     | where IsExploitAvailable == 1
     | project CveId;
    DeviceTvmSoftwareVulnerabilities
    | where CveId in (ExploitableVulnerabilities)
    | summarize TotalExploitableVulns = dcount(CveId), ExploitableCVE = make_set(CveId) by DeviceId
    | top 10 by TotalExploitableVulns
  condition: _kql_query
references:
  - https://github.com/Bert-JanP/Hunting-Queries-Detection-Rules
