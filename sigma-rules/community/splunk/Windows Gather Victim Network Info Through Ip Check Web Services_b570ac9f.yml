title: Windows Gather Victim Network Info Through Ip Check Web Services
id: 07ad45d0-ab8f-51e8-ab87-154c39c36eb8
status: stable
level: medium
description: |
  The following analytic detects processes attempting to connect to known IP check web services. This behavior is identified using Sysmon EventCode 22 logs, specifically monitoring DNS queries to services like "wtfismyip.com" and "ipinfo.io". This activity is significant as it is commonly used by malware, such as Trickbot, for reconnaissance to determine the infected machine's IP address. If confirmed malicious, this could allow attackers to gather network information, aiding in further attacks or
author: Teoderick Contreras, Splunk
logsource:
  product: windows
  category: network_connection
detection:
  selection:
    eventcode: 22
    queryname:
      - '*wtfismyip.com'
      - '*checkip.*'
      - '*ipecho.net'
      - '*ipinfo.io'
      - '*api.ipify.org'
      - '*icanhazip.com'
      - '*ip.anysrc.com'
      - '*api.ip.sb'
      - ident.me
      - www.myexternalip.com
      - '*zen.spamhaus.org'
      - '*cbl.abuseat.org'
      - '*b.barracudacentral.org'
      - '*dnsbl-1.uceprotect.net'
      - '*spam.dnsbl.sorbs.net'
      - '*iplogger.org*'
      - '*ip-api.com*'
      - '*geoip.*'
      - '*icanhazip.*'
      - '*ipwho.is*'
      - '*ifconfig.me*'
      - '*myip.com*'
      - '*ipstack.com*'
      - '*myexternalip.com*'
      - '*ip-api.io*'
      - '*trackip.net*'
      - '*ipgeolocation.io*'
      - '*ipfind.io*'
      - '*freegeoip.app*'
      - '*ipv4bot.whatismyipaddress.com*'
  condition: selection
tags:
  - attack.t1590.005
references:
  - https://app.any.run/tasks/a6f2ffe2-e6e2-4396-ae2e-04ea0143f2d8/
custom_attributes:
  original_rule_id: 70f7c952-0758-46d6-9148-d8969c4481d1
  source_format: splunk_spl