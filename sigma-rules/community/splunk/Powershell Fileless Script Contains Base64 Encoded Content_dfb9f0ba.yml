title: Powershell Fileless Script Contains Base64 Encoded Content
id: feaa63c8-85a3-58de-aa44-42eeef30e31a
status: stable
level: high
description: |
  The following analytic detects the execution of PowerShell scripts containing Base64 encoded content, specifically identifying the use of `FromBase64String`. It leverages PowerShell Script Block Logging (EventCode=4104) to capture and analyze the full command sent to PowerShell. This activity is significant as Base64 encoding is often used by attackers to obfuscate malicious payloads, making it harder to detect. If confirmed malicious, this could lead to code execution, allowing attackers to run
author: Michael Haag, Splunk
logsource:
  product: windows
  category: file_event
detection:
  selection:
    scriptblocktext:
      - '*frombase64string*'
      - '*gnirtS46esaBmorF*'
    eventcode: 4104
  condition: selection
tags:
  - attack.t1027
  - attack.t1059.001
references:
  - https://help.splunk.com/en/security-offerings/splunk-user-behavior-analytics/get-data-in/5.4.1/add-other-data-to-splunk-uba/configure-powershell-logging-to-see-powershell-anomalies-in-splunk-uba.
  - https://blog.palantir.com/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63
  - https://static1.squarespace.com/static/552092d5e4b0661088167e5c/t/59c1814829f18782e24f1fe2/1505853768977/Windows+PowerShell+Logging+Cheat+Sheet+ver+Sept+2017+v2.1.pdf
  - https://www.crowdstrike.com/blog/investigating-powershell-command-and-script-logging/
  - https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/
custom_attributes:
  original_rule_id: 8acbc04c-c882-11eb-b060-acde48001122
  source_format: splunk_spl