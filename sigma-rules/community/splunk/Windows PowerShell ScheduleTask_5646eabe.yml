title: Windows PowerShell ScheduleTask
id: 3593fcec-f76c-5590-a590-9b42be3ee13f
status: stable
level: medium
description: |
  The following analytic detects potential malicious activities involving PowerShell's task scheduling cmdlets. It leverages PowerShell Script Block Logging (EventCode 4104) to identify unusual or suspicious use of cmdlets like 'New-ScheduledTask' and 'Set-ScheduledTask'. This activity is significant as attackers often use these cmdlets for persistence and remote execution of malicious code. If confirmed malicious, this could allow attackers to maintain access, deliver additional payloads, or exec
author: Michael Haag, Splunk
logsource:
  product: windows
detection:
  selection:
    eventcode: 4104
    scriptblocktext:
      - '*New-ScheduledTask*'
      - '*New-ScheduledTaskAction*'
      - '*New-ScheduledTaskSettingsSet*'
      - '*New-ScheduledTaskTrigger*'
      - '*Register-ClusteredScheduledTask*'
      - '*Register-ScheduledTask*'
      - '*Set-ClusteredScheduledTask*'
      - '*Set-ScheduledTask*'
      - '*Start-ScheduledTask*'
      - '*Enable-ScheduledTask*'
  condition: selection
tags:
  - attack.t1053.005
  - attack.t1059.001
references:
  - https://learn.microsoft.com/en-us/powershell/module/scheduledtasks/?view=windowsserver2022-ps
  - https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/
custom_attributes:
  original_rule_id: ddf82fcb-e9ee-40e3-8712-a50b5bf323fc
  source_format: splunk_spl