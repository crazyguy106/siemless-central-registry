title: Get DomainUser with PowerShell Script Block
id: 12ba13bd-c5eb-59f1-abea-678b39c1ea40
status: stable
level: high
description: |
  The following analytic detects the execution of the `Get-DomainUser` cmdlet using PowerShell Script Block Logging (EventCode=4104). This cmdlet is part of PowerView, a tool often used for domain enumeration. The detection leverages PowerShell operational logs to identify instances where this command is executed. Monitoring this activity is crucial as it may indicate an adversary's attempt to gather information about domain users, which is a common step in Active Directory Discovery. If confirmed
author: Teoderick Contreras, Mauricio Velazco, Splunk
logsource:
  product: windows
detection:
  selection:
    scriptblocktext: '*Get-DomainUser*'
    eventcode: 4104
  condition: selection
tags:
  - attack.t1087.002
references:
  - https://powersploit.readthedocs.io/en/latest/Recon/Get-DomainUser/
custom_attributes:
  original_rule_id: 61994268-04f4-11ec-865c-acde48001122
  source_format: splunk_spl