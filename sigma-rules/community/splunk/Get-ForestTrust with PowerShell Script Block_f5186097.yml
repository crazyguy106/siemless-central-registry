title: Get-ForestTrust with PowerShell Script Block
id: 24e1baa1-a3da-562a-b7d0-085632e9dff9
status: stable
level: high
description: |
  The following analytic detects the execution of the Get-ForestTrust command from PowerSploit using PowerShell Script Block Logging (EventCode=4104). This method captures the full command sent to PowerShell, providing detailed visibility into potentially suspicious activities. Monitoring this behavior is crucial as it can indicate an attempt to gather domain trust information, which is often a precursor to lateral movement or privilege escalation. If confirmed malicious, this activity could allow
author: Michael Haag, Splunk
logsource:
  product: windows
detection:
  selection:
    scriptblocktext: '*get-foresttrust*'
    eventcode: 4104
  condition: selection
tags:
  - attack.t1482
  - attack.t1059.001
references:
  - https://powersploit.readthedocs.io/en/latest/Recon/Get-ForestTrust/
  - https://www.splunk.com/en_us/blog/security/hunting-for-malicious-powershell-using-script-block-logging.html
custom_attributes:
  original_rule_id: 70fac80e-0bf1-11ec-9ba0-acde48001122
  source_format: splunk_spl