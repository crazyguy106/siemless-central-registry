title: Domain Account Discovery with Dsquery
id: 9114f401-6d30-5f9c-8fd3-f9c0206d469d
status: stable
level: medium
description: |
  The following analytic identifies the execution of `dsquery.exe` with command-line arguments used to discover domain users. It leverages data from Endpoint Detection and Response (EDR) agents, focusing on process names and command-line executions. This activity is significant as it indicates potential reconnaissance efforts by adversaries to map out domain users, which is a common precursor to further attacks. If confirmed malicious, this behavior could allow attackers to gain insights into user
author: Teoderick Contreras, Mauricio Velazco, Splunk
logsource:
  product: splunk
detection:
  selection:
    process_name: dsquery.exe
    process: '*user*'
  condition: selection
tags:
  - attack.t1087.002
references:
  - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/dsquery.htm
  - https://attack.mitre.org/techniques/T1087/002/
custom_attributes:
  original_rule_id: b1a8ce04-04c2-11ec-bea7-acde48001122
  source_format: splunk_spl