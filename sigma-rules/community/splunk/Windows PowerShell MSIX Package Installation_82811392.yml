title: Windows PowerShell MSIX Package Installation
id: b9b32053-b14c-59d8-bd44-8dfe7dd9cb95
status: stable
level: high
description: |
  The following analytic detects the execution of PowerShell commands to install unsigned AppX packages using Add-AppxPackage or Add-AppPackage cmdlets with the -AllowUnsigned flag. This detection leverages PowerShell Script Block Logging (EventCode=4104) to capture the full command content. This activity is significant as adversaries may use unsigned AppX packages to install malicious applications, bypass security controls, or establish persistence. If confirmed malicious, this could allow attack
author: Michael Haag, Splunk
logsource:
  product: windows
detection:
  selection:
    eventcode: 4104
    scriptblocktext:
      - '* -AllowUnsigned*'
  condition: selection
tags:
  - attack.t1059.001
  - attack.t1547.001
references:
  - https://learn.microsoft.com/en-us/windows/msix/package/unsigned-package
  - https://learn.microsoft.com/en-us/windows/msix/desktop/powershell-msix-cmdlets
  - https://learn.microsoft.com/en-us/powershell/module/appx/add-appxpackage
  - https://twitter.com/WindowsDocs/status/1620078135080325122
  - https://attack.mitre.org/techniques/T1059/001/
custom_attributes:
  original_rule_id: d2f77901-dbfa-42d9-8af7-dcd0f1a50a2f
  source_format: splunk_spl