title: Get WMIObject Group Discovery with Script Block Logging
id: d20dabd8-96fc-5d81-8c14-ca5af72fca5d
status: stable
level: low
description: |
  The following analytic detects the execution of the `Get-WMIObject Win32_Group` command using PowerShell Script Block Logging (EventCode=4104). This method captures the full command sent to PowerShell, allowing for detailed analysis. Identifying group information on an endpoint is not inherently malicious but can be suspicious based on context such as time, endpoint, and user. This activity is significant as it may indicate reconnaissance efforts by an attacker. If confirmed malicious, it could 
author: Michael Haag, Splunk
logsource:
  product: windows
detection:
  selection:
    scriptblocktext:
      - '*Get-WMIObject*'
      - '*Win32_Group*'
    eventcode: 4104
  condition: selection
tags:
  - attack.t1069.001
references:
  - https://www.splunk.com/en_us/blog/security/powershell-detections-threat-research-release-august-2021.html
  - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.001/T1069.001.md
  - https://help.splunk.com/en/security-offerings/splunk-user-behavior-analytics/get-data-in/5.4.1/add-other-data-to-splunk-uba/configure-powershell-logging-to-see-powershell-anomalies-in-splunk-uba.
  - https://blog.palantir.com/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63
  - https://static1.squarespace.com/static/552092d5e4b0661088167e5c/t/59c1814829f18782e24f1fe2/1505853768977/Windows+PowerShell+Logging+Cheat+Sheet+ver+Sept+2017+v2.1.pdf
custom_attributes:
  original_rule_id: 69df7f7c-155d-11ec-a055-acde48001122
  source_format: splunk_spl