title: Windows PowerView Constrained Delegation Discovery
id: 02f6e4cb-e8e0-51e9-b5bf-626ae90460a5
status: stable
level: high
description: |
  The following analytic detects the use of PowerView commandlets to discover Windows endpoints with Kerberos Constrained Delegation. It leverages PowerShell Script Block Logging (EventCode=4104) to identify specific commandlets like `Get-DomainComputer` or `Get-NetComputer` with the `-TrustedToAuth` parameter. This activity is significant as it indicates potential reconnaissance efforts by adversaries or Red Teams to map out privileged delegation settings in Active Directory. If confirmed malicio
author: Mauricio Velazco, Splunk
logsource:
  product: windows
detection:
  selection:
    scriptblocktext:
      - '*Get-DomainComputer*'
      - '*Get-NetComputer*'
      - '*-TrustedToAuth*'
    eventcode: 4104
  condition: selection
tags:
  - attack.t1018
references:
  - https://attack.mitre.org/techniques/T1018/
  - https://adsecurity.org/?p=1667
  - https://docs.microsoft.com/en-us/defender-for-identity/cas-isp-unconstrained-kerberos
  - https://www.guidepointsecurity.com/blog/delegating-like-a-boss-abusing-kerberos-delegation-in-active-directory/
  - https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/constrained-delegation
custom_attributes:
  original_rule_id: 86dc8176-6e6c-42d6-9684-5444c6557ab3
  source_format: splunk_spl