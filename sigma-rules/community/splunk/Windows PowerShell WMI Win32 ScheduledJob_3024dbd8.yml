title: Windows PowerShell WMI Win32 ScheduledJob
id: ea565503-e05b-59a2-bc5c-cbaddfb110af
status: stable
level: high
description: |
  The following analytic detects the use of the Win32_ScheduledJob WMI class via PowerShell script block logging. This class, which manages scheduled tasks, is disabled by default due to security concerns and must be explicitly enabled through registry modifications. The detection leverages PowerShell event code 4104 and script block text analysis. Monitoring this activity is crucial as it may indicate malicious intent, especially if the class was enabled by an attacker. If confirmed malicious, th
author: Michael Haag, Splunk
logsource:
  product: windows
detection:
  selection:
    scriptblocktext: '*win32_scheduledjob*'
    eventcode: 4104
  condition: selection
tags:
  - attack.t1059.001
references:
  - https://securityonline.info/wmiexec-regout-get-outputdata-response-from-registry/
  - https://learn.microsoft.com/en-us/windows/win32/cimwin32prov/win32-scheduledjob
custom_attributes:
  original_rule_id: 47c69803-2c09-408b-b40a-063c064cbb16
  source_format: splunk_spl