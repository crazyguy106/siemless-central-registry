title: Windows Root Domain linked policies Discovery
id: c663f610-4e9a-5b13-a055-267544260ab6
status: stable
level: medium
description: |
  The following analytic detects the use of the `[Adsisearcher]` type accelerator in PowerShell to query Active Directory for root domain linked policies. It leverages PowerShell Script Block Logging (EventCode=4104) to identify this activity. This behavior is significant as it may indicate an attempt by adversaries or Red Teams to gain situational awareness and perform Active Directory Discovery. If confirmed malicious, this activity could allow attackers to map out domain policies, potentially a
author: Teoderick Contreras, Splunk
logsource:
  product: windows
detection:
  selection:
    scriptblocktext:
      - '*[adsisearcher]*'
      - '*.SearchRooT*'
      - '*.gplink*'
    eventcode: 4104
  condition: selection
tags:
  - attack.t1087.002
references:
  - https://www.welivesecurity.com/2022/04/12/industroyer2-industroyer-reloaded/
  - https://medium.com/@pentesttas/discover-hidden-gpo-s-on-active-directory-using-ps-adsi-a284b6814c81
custom_attributes:
  original_rule_id: 80ffaede-1f12-49d5-a86e-b4b599b68b3c
  source_format: splunk_spl