title: Malicious PowerShell Process - Encoded Command
id: f45d71a3-db49-5b6e-935c-16d3ae3099ee
status: stable
level: low
description: |
  The following analytic detects the use of the EncodedCommand parameter in PowerShell processes. It leverages Endpoint Detection and Response (EDR) data to identify variations of the EncodedCommand parameter, including shortened forms and different command switch types. This activity is significant because adversaries often use encoded commands to obfuscate malicious scripts, making detection harder. If confirmed malicious, this behavior could allow attackers to execute hidden code, potentially l
author: David Dorsey, Michael Haag, Splunk, SirDuckly, GitHub Community
logsource:
  product: windows
  category: process_creation
detection:
  selection:
    _spl_reference: true
  condition: selection
tags:
  - attack.t1027
references:
  - https://regexr.com/662ov
  - https://github.com/redcanaryco/AtomicTestHarnesses/blob/master/Windows/TestHarnesses/T1059.001_PowerShell/OutPowerShellCommandLineParameter.ps1
  - https://ss64.com/ps/powershell.html
  - https://twitter.com/M_haggis/status/1440758396534214658?s=20
  - https://www.microsoft.com/security/blog/2022/01/15/destructive-malware-targeting-ukrainian-organizations/
custom_attributes:
  original_rule_id: c4db14d9-7909-48b4-a054-aa14d89dbb19
  source_format: splunk_spl