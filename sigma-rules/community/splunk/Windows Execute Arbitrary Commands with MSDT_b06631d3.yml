title: Windows Execute Arbitrary Commands with MSDT
id: 59b67061-a1e4-5257-a966-f18da4b739a6
status: stable
level: high
description: |
  The following analytic detects arbitrary command execution using Windows msdt.exe, a Diagnostics Troubleshooting Wizard. It leverages Endpoint Detection and Response (EDR) data to identify instances where msdt.exe is invoked via the ms-msdt:/ protocol handler to retrieve a remote payload. This activity is significant as it can indicate an exploitation attempt leveraging msdt.exe to execute arbitrary commands, potentially leading to unauthorized code execution. If confirmed malicious, this could 
author: Michael Haag, Teoderick Contreras, Splunk
logsource:
  product: windows
  category: process_creation
detection:
  selection:
    process:
      - '*msdt*'
      - '*ms-msdt:*'
      - '*ms-msdt:/id*'
      - '*ms-msdt:-id*'
      - '*/id*'
  condition: selection
tags:
  - attack.t1218
references:
  - https://isc.sans.edu/diary/rss/28694
  - https://doublepulsar.com/follina-a-microsoft-office-code-execution-vulnerability-1a47fce5629e
  - https://twitter.com/nao_sec/status/1530196847679401984?s=20&t=ZiXYI4dQuA-0_dzQzSUb3A
  - https://app.any.run/tasks/713f05d2-fe78-4b9d-a744-f7c133e3fafb/
  - https://www.virustotal.com/gui/file/4a24048f81afbe9fb62e7a6a49adbd1faf41f266b5f9feecdceb567aec096784/detection
custom_attributes:
  original_rule_id: e1d5145f-38fe-42b9-a5d5-457796715f97
  source_format: splunk_spl