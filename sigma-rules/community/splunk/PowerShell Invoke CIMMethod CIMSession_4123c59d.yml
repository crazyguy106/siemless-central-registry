title: PowerShell Invoke CIMMethod CIMSession
id: 7b1142ee-0ea2-57fa-9f90-42704804871a
status: stable
level: medium
description: |
  The following analytic detects the creation of a New-CIMSession cmdlet followed by the use of the Invoke-CIMMethod cmdlet within PowerShell. It leverages PowerShell Script Block Logging to identify these specific cmdlets in the ScriptBlockText field. This activity is significant because it mirrors the behavior of the Invoke-WMIMethod cmdlet, often used for remote code execution via NTLMv2 pass-the-hash authentication. If confirmed malicious, this could allow an attacker to execute commands remot
author: Michael Haag, Splunk
logsource:
  product: windows
detection:
  selection:
    eventcode: 4104
    scriptblocktext:
      - '*invoke-CIMMethod*'
      - '*New-CimSession*'
  condition: selection
tags:
  - attack.t1047
references:
  - https://learn.microsoft.com/en-us/powershell/module/cimcmdlets/invoke-cimmethod?view=powershell-7.3
custom_attributes:
  original_rule_id: 651ee958-a433-471c-b264-39725b788b83
  source_format: splunk_spl