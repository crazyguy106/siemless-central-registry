title: Windows Get-AdComputer Unconstrained Delegation Discovery
id: e8f92efe-c285-5e10-a855-c4b6fa13eb7a
status: stable
level: high
description: |
  The following analytic detects the use of the Get-ADComputer cmdlet with parameters indicating a search for Windows endpoints with Kerberos Unconstrained Delegation. It leverages PowerShell Script Block Logging (EventCode=4104) to identify this specific activity. This behavior is significant as it may indicate an attempt by adversaries or Red Teams to gain situational awareness and perform Active Directory discovery. If confirmed malicious, this activity could allow attackers to identify high-va
author: Mauricio Velazco, Splunk
logsource:
  product: windows
detection:
  selection:
    scriptblocktext:
      - '*Get-ADComputer*'
      - '*TrustedForDelegation*'
    eventcode: 4104
  condition: selection
tags:
  - attack.t1018
references:
  - https://attack.mitre.org/techniques/T1018/
  - https://adsecurity.org/?p=1667
  - https://docs.microsoft.com/en-us/defender-for-identity/cas-isp-unconstrained-kerberos
  - https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/domain-compromise-via-unrestricted-kerberos-delegation
  - https://www.cyberark.com/resources/threat-research-blog/weakness-within-kerberos-delegation
custom_attributes:
  original_rule_id: c8640777-469f-4638-ab44-c34a3233ffac
  source_format: splunk_spl