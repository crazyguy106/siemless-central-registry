title: Powershell COM Hijacking InprocServer32 Modification
id: ad86ae5f-b998-59a4-af03-21bb0b808918
status: stable
level: high
description: |
  The following analytic detects attempts to modify or add a Component Object Model (COM) entry to the InProcServer32 path within the registry using PowerShell. It leverages PowerShell ScriptBlock Logging (EventCode 4104) to identify suspicious script blocks that target the InProcServer32 registry path. This activity is significant because modifying COM objects can be used for persistence or privilege escalation by attackers. If confirmed malicious, this could allow an attacker to execute arbitrar
author: Michael Haag, Splunk
logsource:
  product: windows
detection:
  selection:
    scriptblocktext: '*Software\\Classes\\CLSID\\*\\InProcServer32*'
    eventcode: 4104
  condition: selection
tags:
  - attack.t1059.001
  - attack.t1546.015
references:
  - https://attack.mitre.org/techniques/T1546/015/
  - https://www.splunk.com/en_us/blog/security/hunting-for-malicious-powershell-using-script-block-logging.html
  - https://blog.cluster25.duskrise.com/2022/09/23/in-the-footsteps-of-the-fancy-bear-powerpoint-graphite/
  - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.015/T1546.015.md
custom_attributes:
  original_rule_id: ea61e291-af05-4716-932a-67faddb6ae6f
  source_format: splunk_spl