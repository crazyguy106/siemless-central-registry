title: Potential Lateral Tool Transfer via SMB Share
id: 58bc134c-e8d2-4291-a552-b4b3e537c60b
status: stable
level: medium
description: 'Identifies the creation or change of a Windows executable file over
  network shares. Adversaries may transfer tools or

  other files between systems in a compromised environment.'
author: Elastic (converted by SIEMLess)
date: '2020-11-10'
modified: '2024-09-23'
logsource:
  product: windows
  category: network_connection
detection:
  selection:
    _original_eql: "sequence by host.id with maxspan=30s\n  [network where host.os.type\
      \ == \"windows\" and event.type == \"start\" and process.pid == 4 and destination.port\
      \ == 445 and\n   network.direction : (\"incoming\", \"ingress\") and\n   network.transport\
      \ == \"tcp\" and source.ip != \"127.0.0.1\" and source.ip != \"::1\"\n  ] by\
      \ process.entity_id\n  /* add more executable extensions here if they are not\
      \ noisy in your environment */\n  [file where host.os.type == \"windows\" and\
      \ event.type in (\"creation\", \"change\") and process.pid == 4 and \n   (file.Ext.header_bytes\
      \ : \"4d5a*\" or file.extension : (\"exe\", \"scr\", \"pif\", \"com\", \"dll\"\
      ))] by process.entity_id"
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.lateral_movement
- attack.t1021
- attack.t1021.002
- attack.t1570
references:
- https://www.elastic.co/security-labs/elastic-protects-against-data-wiper-malware-targeting-ukraine-hermeticwiper
- https://www.elastic.co/security-labs/hunting-for-lateral-movement-using-event-query-language
