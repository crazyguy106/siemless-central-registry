title: Potential Reverse Shell
id: 48b3d2e3-f4e8-41e6-95e6-9b2091228db3
status: stable
level: medium
description: 'This detection rule identifies suspicious network traffic patterns associated
  with TCP reverse shell activity. This

  activity consists of a parent-child relationship where a network event is followed
  by the creation of a shell process.

  An attacker may establish a Linux TCP reverse shell to gain remote access to a target
  system.'
author: Elastic (converted by SIEMLess)
date: '2023-07-04'
modified: '2025-02-04'
logsource:
  product: linux
  category: process_creation
detection:
  selection:
    _original_eql: "sequence by host.id with maxspan=5s\n  [network where event.type\
      \ == \"start\" and host.os.type == \"linux\" and\n     event.action in (\"connection_attempted\"\
      , \"connection_accepted\") and\n     process.name : (\"bash\", \"dash\", \"\
      sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\", \"socat\") and destination.ip\
      \ != null and\n     not cidrmatch(destination.ip, \"127.0.0.0/8\", \"169.254.0.0/16\"\
      , \"224.0.0.0/4\", \"::1\")] by process.entity_id\n  [process where event.type\
      \ == \"start\" and host.os.type == \"linux\" and event.action in (\"exec\",\
      \ \"fork\") and\n     process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\"\
      , \"csh\", \"zsh\", \"ksh\", \"fish\") and (\n       (process.args : (\"-i\"\
      , \"-l\")) or (process.parent.name == \"socat\" and process.parent.args : \"\
      *exec*\")\n   )] by process.parent.entity_id"
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.execution
- attack.command_and_control
- attack.t1059
- attack.t1059.004
- attack.t1071
references:
- https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md
