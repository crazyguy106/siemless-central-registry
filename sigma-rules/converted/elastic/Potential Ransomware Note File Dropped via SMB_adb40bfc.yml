title: Potential Ransomware Note File Dropped via SMB
id: 02bab13d-fb14-4d7c-b6fe-4a28874d37c5
status: stable
level: high
description: 'Identifies an incoming SMB connection followed by the creation of a
  file with a name similar to ransomware note files.

  This may indicate a remote ransomware attack via the SMB protocol.'
author: Elastic (converted by SIEMLess)
date: '2024-05-02'
modified: '2025-02-14'
logsource:
  product: windows
  category: file_event
detection:
  selection:
    _original_eql: "sequence by host.id with maxspan=1s\n [network where host.os.type\
      \ == \"windows\" and\n  event.action == \"connection_accepted\" and destination.port\
      \ == 445 and source.port >= 49152 and process.pid == 4 and\n  source.ip != \"\
      127.0.0.1\" and source.ip != \"::1\" and\n  network.type == \"ipv4\" and not\
      \ endswith(source.address, destination.address)]\n [file where host.os.type\
      \ == \"windows\" and event.action == \"creation\" and\n  process.pid == 4 and\
      \ user.id : (\"S-1-5-21*\", \"S-1-12-*\") and file.extension : (\"hta\", \"\
      txt\", \"readme\", \"htm*\") and\n  file.path : \"C:\\\\Users\\\\*\" and\n \
      \  /* ransom file name keywords */\n    file.name : (\"*read*me*\", \"*lock*\"\
      , \"*@*\", \"*RECOVER*\", \"*decrypt*\", \"*restore*file*\", \"*FILES_BACK*\"\
      , \"*how*to*\")] with runs=3"
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.impact
- attack.lateral_movement
- attack.t1485
- attack.t1021
- attack.t1021.002
- attack.t1490
