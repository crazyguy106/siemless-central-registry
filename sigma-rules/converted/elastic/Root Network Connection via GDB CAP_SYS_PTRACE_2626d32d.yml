title: Root Network Connection via GDB CAP_SYS_PTRACE
id: 28bc620d-b2f7-4132-b372-f77953881d05
status: stable
level: medium
description: 'Identifies instances where GDB (granted the CAP_SYS_PTRACE capability)
  is executed, after which an outbound network

  connection is initiated by UID/GID 0 (root). In Linux, the CAP_SYS_PTRACE capability
  grants a process the ability to use

  the ptrace system call, which is typically used for debugging and allows the process
  to trace and control other

  processes. Attackers may leverage this capability to hook and inject into a process
  that is running with root

  permissions in order to execute shell code and gain a reverse shell with root privileges.'
author: Elastic (converted by SIEMLess)
date: '2024-01-09'
modified: '2025-02-04'
logsource:
  product: linux
  category: process_creation
detection:
  selection:
    _original_eql: "sequence by host.id, process.entry_leader.entity_id with maxspan=30s\n\
      \  [process where host.os.type == \"linux\" and event.type == \"start\" and\
      \ event.action == \"exec\" and process.name == \"gdb\" and\n   (process.thread.capabilities.effective\
      \ : \"CAP_SYS_PTRACE\" or process.thread.capabilities.permitted : \"CAP_SYS_PTRACE\"\
      ) and\n   user.id != \"0\"]\n  [network where host.os.type == \"linux\" and\
      \ event.action == \"connection_attempted\" and event.type == \"start\" and\n\
      \   process.name != null and user.id == \"0\"]"
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.execution
- attack.privilege_escalation
- attack.command_and_control
- attack.t1055.008
- attack.t1071
- attack.t1059
- attack.t1068
- attack.t1059.004
- attack.t1055
