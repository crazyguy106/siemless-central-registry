title: Potential JAVA/JNDI Exploitation Attempt
id: c3f5e1d8-910e-43b4-8d44-d748e498ca86
status: stable
level: high
description: 'Identifies an outbound network connection by JAVA to LDAP, RMI or DNS
  standard ports followed by a suspicious JAVA child

  processes. This may indicate an attempt to exploit a JAVA/NDI (Java Naming and Directory
  Interface) injection

  vulnerability.'
author: Elastic (converted by SIEMLess)
date: '2021-12-10'
modified: '2025-01-27'
logsource:
  product: linux
  category: process_creation
detection:
  selection:
    _original_eql: "sequence by host.id with maxspan=1m\n [network where event.action\
      \ == \"connection_attempted\" and\n  process.name : \"java\" and\n  /*\n   \
      \  outbound connection attempt to\n     LDAP, RMI or DNS standard ports\n  \
      \   by JAVA process\n   */\n  destination.port in (1389, 389, 1099, 53, 5353)]\
      \ by process.pid\n [process where event.type == \"start\" and\n\n  /* Suspicious\
      \ JAVA child process */\n  process.parent.name : \"java\" and\n   process.name\
      \ : (\"sh\",\n                   \"bash\",\n                   \"dash\",\n \
      \                  \"ksh\",\n                   \"tcsh\",\n                \
      \   \"zsh\",\n                   \"curl\",\n                   \"perl*\",\n\
      \                   \"python*\",\n                   \"ruby*\",\n          \
      \         \"php*\",\n                   \"wget\") and\n    not process.command_line\
      \ like~ (\n      \"bash -c ulimit -u\",\n      \"bash /opt/flutter/bin/flutter*\"\
      ,\n      \"bash -c echo $$\",\n      \"/bin/bash /opt/python3/bin/jira*\",\n\
      \      \"/bin/sh -c env LC_ALL=C /usr/sbin/lpc status*\"\n    )] by process.parent.pid"
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.execution
- attack.t1059
- attack.t1203
- attack.t1059.007
references:
- https://www.lunasec.io/docs/blog/log4j-zero-day/
- https://github.com/christophetd/log4shell-vulnerable-app
- https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf
- https://www.elastic.co/security-labs/detecting-log4j2-with-elastic-security
- https://www.elastic.co/security-labs/analysis-of-log4shell-cve-2021-45046
