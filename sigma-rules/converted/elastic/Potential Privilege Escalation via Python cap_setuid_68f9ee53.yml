title: Potential Privilege Escalation via Python cap_setuid
id: a0ddb77b-0318-41f0-91e4-8c1b5528834f
status: stable
level: medium
description: 'This detection rule monitors for the execution of a system command with
  setuid or setgid capabilities via Python,

  followed by a uid or gid change to the root user. This sequence of events may indicate
  successful privilege escalation.

  Setuid (Set User ID) and setgid (Set Group ID) are Unix-like OS features that enable
  processes to run with elevated

  privileges, based on the file owner or group. Threat actors can exploit these attributes
  to escalate privileges to the

  privileges that are set on the binary that is being executed.'
author: Elastic (converted by SIEMLess)
date: '2023-09-05'
modified: '2025-02-04'
logsource:
  product: linux
  category: process_creation
detection:
  selection:
    _original_eql: "sequence by host.id, process.entity_id with maxspan=1s\n  [process\
      \ where host.os.type == \"linux\" and event.type == \"start\" and event.action\
      \ == \"exec\" and\n   process.args : \"import os;os.set?id(0);os.system(*)\"\
      \ and process.args : \"*python*\" and user.id != \"0\"]\n  [process where host.os.type\
      \ == \"linux\" and event.action in (\"uid_change\", \"gid_change\") and event.type\
      \ == \"change\" and\n   (user.id == \"0\" or group.id == \"0\")]"
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.privilege_escalation
- attack.t1548.001
- attack.t1068
- attack.t1548
