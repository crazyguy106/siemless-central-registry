title: Shell Execution via Apple Scripting
id: d461fac0-43e8-49e2-85ea-3a58fe120b4f
status: stable
level: medium
description: 'Identifies the execution of the shell process (sh) via scripting (JXA
  or AppleScript). Adversaries may use the

  doShellScript functionality in JXA or do shell script in AppleScript to execute
  system commands.'
author: Elastic (converted by SIEMLess)
date: '2020-12-07'
modified: '2025-03-18'
logsource:
  product: macos
  category: process_creation
detection:
  selection:
    _original_eql: "sequence by host.id with maxspan=10s\n [process where host.os.type\
      \ == \"macos\" and event.type in (\"start\", \"process_started\") and event.action\
      \ == \"exec\" and process.name == \"osascript\" and process.args == \"-e\"]\
      \ by process.entity_id\n [process where host.os.type == \"macos\" and event.type\
      \ in (\"start\", \"process_started\") and process.name in (\"sh\", \"bash\"\
      , \"zsh\") and process.args == \"-c\" and process.command_line : (\"*curl*\"\
      , \"*pbpaste*\", \"*http*\", \"*chmod*\", \"*nscurl*\")] by process.parent.entity_id"
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.execution
- attack.t1059
references:
- https://developer.apple.com/library/archive/technotes/tn2065/_index.html
- https://objectivebythesea.com/v2/talks/OBTS_v2_Thomas.pdf
