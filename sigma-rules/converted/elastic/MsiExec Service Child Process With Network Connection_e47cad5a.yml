title: MsiExec Service Child Process With Network Connection
id: 65432f4a-e716-4cc1-ab11-931c4966da2d
status: stable
level: medium
description: 'Identifies the execution of an MsiExec service child process followed
  by network or dns lookup activity. Adversaries may

  abuse Windows Installers for initial access and delivery of malware.'
author: Elastic (converted by SIEMLess)
date: '2024-09-09'
modified: '2025-08-21'
logsource:
  product: windows
  category: process_creation
detection:
  selection:
    _original_eql: "sequence by process.entity_id with maxspan=1m\n [process where\
      \ host.os.type == \"windows\" and event.type : \"start\" and\n  process.parent.name\
      \ : \"msiexec.exe\" and process.parent.args : \"/v\" and\n  not process.executable\
      \ :\n        (\"?:\\\\Windows\\\\System32\\\\msiexec.exe\",\n         \"?:\\\
      \\Windows\\\\sysWOW64\\\\msiexec.exe\",\n         \"?:\\\\Windows\\\\system32\\\
      \\srtasks.exe\",\n         \"?:\\\\Windows\\\\syswow64\\\\srtasks.exe\",\n \
      \        \"?:\\\\Windows\\\\sys*\\\\taskkill.exe\",\n         \"?:\\\\Program\
      \ Files\\\\*.exe\",\n         \"?:\\\\Program Files (x86)\\\\*.exe\",\n    \
      \     \"?:\\\\Windows\\\\Installer\\\\MSI*.tmp\",\n         \"?:\\\\Windows\\\
      \\Microsoft.NET\\\\Framework*\\\\RegSvcs.exe\",\n         \"C:\\\\Windows\\\\\
      System32\\\\regsvr32.exe\",\n         \"C:\\\\Windows\\\\Sys?????\\\\certutil.exe\"\
      ,\n         \"C:\\\\Windows\\\\System32\\\\WerFault.exe\",\n         \"C:\\\\\
      Windows\\\\System32\\\\wevtutil.exe\",\n         \"C:\\\\Windows\\\\SysWOW64\\\
      \\WindowsPowerShell\\\\v1.0\\\\powershell.exe\") and\n not (process.name : (\"\
      rundll32.exe\", \"regsvr32.exe\", \"powershell.exe\", \"regasm.exe\", \"wscript.exe\"\
      ) and process.args : (\"?:\\\\Program Files\\\\*\", \"?:\\\\Program Files (x86)\\\
      \\*\")) and\n not (?process.code_signature.subject_name : (\"Bruno Software\
      \ Inc\", \"Proton AG\", \"Axis Communications AB\", \"Citrix Systems, Inc.\"\
      , \"NSUS Limited\", \"Action1 Corporation\", \"Solarwinds Worldwide, LLC\")\
      \ and\n      ?process.code_signature.trusted == true) and\n not (?process.pe.original_file_name\
      \ in (\"dxsetup.exe\", \"MofCompiler.exe\", \"ShellApp.exe\") and\n      ?process.code_signature.subject_name\
      \ : \"Microsoft Corporation\" and ?process.code_signature.trusted == true) and\n\
      \ not ?process.hash.sha256 in (\"cfaef8c711db04d6c4a4381c66ac21b9e234e57febedb77fedc9316898b214bc\"\
      ,\n                              \"2f26f37cce780ca76f0dbac0de233f4c8d84c31b3f37380b9d5faacc3ee2d03e\"\
      ,\n                              \"7d9c691bfbf3beb78919dfd940fa6d325c3437425d5b0371df39aef6accf858d\"\
      )\n ]\n[network where host.os.type == \"windows\" and process.name != null and\n\
      \ not dns.question.name : (\"core.bdec.microsoft.com\", \"go.microsoft.com\"\
      , \"ocsp.digicert.com\", \"localhost\", \"www.google-analytics.com\",\n    \
      \                      \"ocsp.verisign.com\", \"*.symcb.com\")]"
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.defense_evasion
- attack.t1218.007
- attack.t1218
