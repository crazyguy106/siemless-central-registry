title: Active Directory Forced Authentication from Linux Host - SMB Named Pipes
id: c24e9a43-f67e-431d-991b-09cdb83b3c0c
status: stable
level: medium
description: 'Identifies a potential forced authentication using related SMB named
  pipes. Attackers may attempt to force targets to

  authenticate to a host controlled by them to capture hashes or enable relay attacks.'
author: Elastic (converted by SIEMLess)
date: '2024-07-23'
modified: '2025-02-21'
logsource:
  product: windows
  category: file_event
detection:
  selection:
    _original_eql: 'sequence with maxspan=15s

      [network where host.os.type == "linux" and event.action == "connection_attempted"
      and destination.port == 445 and not startswith~(string(destination.ip), string(host.ip))]
      by host.ip, data_stream.namespace

      [file where host.os.type == "windows" and event.code == "5145" and file.name
      : ("Spoolss", "netdfs", "lsarpc", "lsass", "netlogon", "samr", "efsrpc", "FssagentRpc")]
      by source.ip, data_stream.namespace'
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.credential_access
- attack.t1187
references:
- https://github.com/p0dalirius/windows-coerced-authentication-methods
- https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications
- https://attack.mitre.org/techniques/T1187/
