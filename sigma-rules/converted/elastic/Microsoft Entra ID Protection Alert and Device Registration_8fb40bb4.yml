title: Microsoft Entra ID Protection Alert and Device Registration
id: a6d4e070-b9b9-4294-b028-d9e21ad47413
status: stable
level: high
description: Identifies sequence of events where a Microsoft Entra ID protection alert
  is followed by an attempt to register a new device by the same user principal. This
  behavior may indicate an adversary using a compromised account to register a device,
  potentially leading to unauthorized access to resources or persistence in the environment.
author: Elastic (converted by SIEMLess)
date: '2025-04-30'
modified: '2025-09-30'
logsource:
  product: windows
  category: process_creation
detection:
  selection:
    _original_eql: 'sequence with maxspan=5m

      [any where event.dataset == "azure.identity_protection"] by azure.identityprotection.properties.user_principal_name

      [any where event.dataset == "azure.auditlogs" and event.action == "Register
      device"] by azure.auditlogs.properties.initiated_by.user.userPrincipalName'
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.persistence
- attack.t1098.005
- attack.t1098
- attack.t1078.004
- attack.t1078
references:
- https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-azure-monitor-sign-ins-log-schema
- https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/overview-identity-protection
- https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/howto-identity-protection-investigate-risk
- https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/howto-identity-protection-investigate-risk#investigation-framework
