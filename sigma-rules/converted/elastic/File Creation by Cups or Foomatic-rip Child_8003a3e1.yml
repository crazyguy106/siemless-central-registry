title: File Creation by Cups or Foomatic-rip Child
id: b9b14be7-b7f4-4367-9934-81f07d2f63c4
status: stable
level: high
description: 'This detection rule addresses multiple vulnerabilities in the CUPS printing
  system, including CVE-2024-47176,

  CVE-2024-47076, CVE-2024-47175, and CVE-2024-47177. Specifically, this rule detects
  suspicious file creation events

  executed by child processes of foomatic-rip. These flaws impact components like
  cups-browsed, libcupsfilters, libppd,

  and foomatic-rip, allowing remote unauthenticated attackers to manipulate IPP URLs
  or inject malicious data through

  crafted UDP packets or network spoofing. This can result in arbitrary command execution
  when a print job is initiated.'
author: Elastic (converted by SIEMLess)
date: '2024-09-27'
modified: '2025-03-20'
logsource:
  product: linux
  category: process_creation
detection:
  selection:
    _original_eql: "sequence by host.id with maxspan=10s\n  [process where host.os.type\
      \ == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"\
      start\") and\n   process.parent.name == \"foomatic-rip\" and\n   process.name\
      \ in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\"\
      )] by process.entity_id\n  [file where host.os.type == \"linux\" and event.type\
      \ != \"deletion\" and\n   not (process.name == \"gs\" and file.path like \"\
      /tmp/gs_*\")] by process.parent.entity_id"
  condition: selection
  _conversion_note: Complex EQL with sequence - requires manual review
tags:
- attack.execution
- attack.t1203
references:
- https://www.elastic.co/security-labs/cups-overflow
- https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/
- https://gist.github.com/stong/c8847ef27910ae344a7b5408d9840ee1
- https://github.com/RickdeJager/cupshax/blob/main/cupshax.py
